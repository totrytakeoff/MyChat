# Redisç®¡ç†å™¨æµ‹è¯•é—®é¢˜æ’æŸ¥æŒ‡å—

## ğŸ› å·²å‘ç°å¹¶ä¿®æ­£çš„é—®é¢˜

### 1. å‘½åç©ºé—´é—®é¢˜ âœ… å·²ä¿®æ­£

**é—®é¢˜æè¿°**ï¼š
æµ‹è¯•æ–‡ä»¶ä¸­ä½¿ç”¨äº† `redis_manager()` å’Œ `RedisConfig`ï¼Œä½†æ²¡æœ‰æ­£ç¡®å¼•ç”¨å‘½åç©ºé—´ã€‚

**é”™è¯¯ä¿¡æ¯**ï¼š
```cpp
// é”™è¯¯ä½¿ç”¨
auto& mgr = redis_manager();
RedisConfig config;
```

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
```cpp
// æ­£ç¡®ä½¿ç”¨
auto& mgr = im::db::redis_manager();
im::db::RedisConfig config;
```

**ä¿®æ­£çŠ¶æ€**ï¼šâœ… å·²åœ¨ `test_redis_mgr.cpp` ä¸­å…¨éƒ¨ä¿®æ­£

### 2. å¤´æ–‡ä»¶åŒ…å«è·¯å¾„é—®é¢˜ âœ… å·²ä¿®æ­£

**é—®é¢˜æè¿°**ï¼š
æµ‹è¯•æ–‡ä»¶ä» `common/database/` ç§»åŠ¨åˆ° `test/db/` åï¼ŒåŒ…å«è·¯å¾„éœ€è¦è°ƒæ•´ã€‚

**ä¿®æ­£å‰**ï¼š
```cpp
#include "redis_mgr.hpp"
```

**ä¿®æ­£å**ï¼š
```cpp
#include "../../common/database/redis_mgr.hpp"
```

### 3. ä¸å¿…è¦çš„GMockä¾èµ– âœ… å·²ç§»é™¤

**é—®é¢˜æè¿°**ï¼š
åŸå§‹æµ‹è¯•åŒ…å«äº† `#include <gmock/gmock.h>`ï¼Œä½†å®é™…ä¸éœ€è¦MockåŠŸèƒ½ã€‚

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š
- ç§»é™¤ `#include <gmock/gmock.h>`
- æ‰€æœ‰æµ‹è¯•éƒ½æ˜¯é›†æˆæµ‹è¯•ï¼Œç›´æ¥ä½¿ç”¨çœŸå®Redisè¿æ¥

### 4. CMakeä¾èµ–é…ç½®é—®é¢˜ âš ï¸ éƒ¨åˆ†è§£å†³

**é—®é¢˜æè¿°**ï¼š
ç³»ç»Ÿå¯èƒ½ç¼ºå°‘ä»¥ä¸‹ä¾èµ–ï¼š
- `redis-plus-plus`
- `nlohmann/json`
- `spdlog`

**å½“å‰è§£å†³æ–¹æ¡ˆ**ï¼š
1. åˆ›å»ºäº†ç®€åŒ–ç‰ˆæµ‹è¯• (`test_simple.cpp`) - âœ… å¯è¿è¡Œ
2. åˆ›å»ºäº†å¢å¼ºçš„CMakeé…ç½®ï¼Œæ”¯æŒé™çº§æŸ¥æ‰¾ - ğŸ”„ å¾…æµ‹è¯•
3. æä¾›äº†å®Œæ•´çš„ä¾èµ–å®‰è£…æŒ‡å— (`INSTALL_DEPS.md`)

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶å¯¹æ¯”

### å®Œæ•´ç‰ˆæµ‹è¯• vs ç®€åŒ–ç‰ˆæµ‹è¯•

| ç‰¹æ€§ | å®Œæ•´ç‰ˆ (`test_redis_mgr.cpp`) | ç®€åŒ–ç‰ˆ (`test_simple.cpp`) |
|------|-------------------------------|---------------------------|
| **ä¾èµ–** | Redis, redis++, json, spdlog | ä»…GTest |
| **æµ‹è¯•æ•°é‡** | 25+ æµ‹è¯•ç”¨ä¾‹ | 3ä¸ªåŸºç¡€æµ‹è¯• |
| **Redisè¿æ¥** | âœ… çœŸå®è¿æ¥æµ‹è¯• | âŒ ä»…æ¨¡æ‹Ÿ |
| **å¹¶å‘æµ‹è¯•** | âœ… å¤šçº¿ç¨‹æµ‹è¯• | âŒ æ—  |
| **æ€§èƒ½æµ‹è¯•** | âœ… å‹åŠ›æµ‹è¯• | âŒ æ—  |
| **è¿è¡Œæ¡ä»¶** | éœ€è¦RedisæœåŠ¡ | æ— éœ€å¤–éƒ¨æœåŠ¡ |

## ğŸš€ æ¨èçš„æµ‹è¯•æµç¨‹

### é˜¶æ®µ1ï¼šéªŒè¯æµ‹è¯•æ¡†æ¶ âœ… å®Œæˆ
```bash
cd test/db
# è¿è¡Œç®€åŒ–ç‰ˆæµ‹è¯•éªŒè¯GTestå·¥ä½œæ­£å¸¸
cd build_simple && ./test_simple
```

### é˜¶æ®µ2ï¼šå®‰è£…å®Œæ•´ä¾èµ–
```bash
# å‚è€ƒ INSTALL_DEPS.md
sudo apt-get install libgtest-dev libhiredis-dev nlohmann-json3-dev libspdlog-dev redis-server

# å®‰è£…redis-plus-plus
git clone https://github.com/sewenew/redis-plus-plus.git
cd redis-plus-plus && mkdir build && cd build
cmake .. && make -j4 && sudo make install
```

### é˜¶æ®µ3ï¼šè¿è¡Œå®Œæ•´æµ‹è¯•
```bash
cd test/db
# æ¢å¤å®Œæ•´ç‰ˆCMakeLists.txt
cp CMakeLists_full.txt CMakeLists.txt  # éœ€è¦åˆ›å»ºè¿™ä¸ªæ–‡ä»¶
./run_tests.sh
```

## ğŸ“ æ–‡ä»¶çŠ¶æ€æ€»è§ˆ

```
test/db/
â”œâ”€â”€ test_redis_mgr.cpp      âœ… å‘½åç©ºé—´å·²ä¿®æ­£ï¼Œä»£ç å®Œæ•´
â”œâ”€â”€ test_simple.cpp         âœ… å¯è¿è¡Œçš„ç®€åŒ–ç‰ˆæœ¬
â”œâ”€â”€ CMakeLists.txt          ğŸ”„ å½“å‰æ˜¯ç®€åŒ–ç‰ˆ
â”œâ”€â”€ CMakeLists_simple.txt   âœ… ç®€åŒ–ç‰ˆé…ç½®
â”œâ”€â”€ run_tests.sh            âœ… å¢å¼ºç‰ˆæµ‹è¯•è„šæœ¬
â”œâ”€â”€ test_config.json        âœ… æµ‹è¯•é…ç½®
â”œâ”€â”€ TEST_README.md          âœ… è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ INSTALL_DEPS.md         âœ… ä¾èµ–å®‰è£…æŒ‡å—
â””â”€â”€ TROUBLESHOOTING.md      âœ… æœ¬æ–‡æ¡£
```

## ğŸ”§ ä¸‹ä¸€æ­¥æ“ä½œå»ºè®®

1. **ç«‹å³å¯ç”¨**ï¼šç®€åŒ–ç‰ˆæµ‹è¯•å·²ç»å¯ä»¥è¿è¡Œï¼ŒéªŒè¯äº†ä»£ç ç»“æ„æ­£ç¡®

2. **é€æ­¥å®Œå–„**ï¼š
   ```bash
   # å®‰è£…å•ä¸ªä¾èµ–å¹¶æµ‹è¯•
   sudo apt-get install nlohmann-json3-dev
   sudo apt-get install libspdlog-dev
   sudo apt-get install libhiredis-dev
   # æœ€åå®‰è£…redis-plus-plus
   ```

3. **éªŒè¯æ–¹æ³•**ï¼š
   ```bash
   # æ¯å®‰è£…ä¸€ä¸ªä¾èµ–ï¼Œæµ‹è¯•pkg-config
   pkg-config --exists nlohmann_json || echo "è¿˜æœªå®‰è£…"
   pkg-config --exists spdlog || echo "è¿˜æœªå®‰è£…"  
   pkg-config --exists redis++ || echo "è¿˜æœªå®‰è£…"
   ```

## ğŸ’¡ è®¾è®¡äº®ç‚¹

å°½ç®¡é‡åˆ°äº†ä¾èµ–é—®é¢˜ï¼Œä½†æµ‹è¯•ä»£ç æœ¬èº«çš„è®¾è®¡æ˜¯å®Œå–„çš„ï¼š

- âœ… **å®Œæ•´è¦†ç›–**ï¼šæ¶µç›–é…ç½®ã€è¿æ¥ã€æ“ä½œã€å¹¶å‘ã€ç›‘æ§ç­‰å„ä¸ªæ–¹é¢
- âœ… **é”™è¯¯å¤„ç†**ï¼šåŒ…å«å¼‚å¸¸æƒ…å†µå’Œè¾¹ç•Œæµ‹è¯•
- âœ… **æ€§èƒ½éªŒè¯**ï¼šå‹åŠ›æµ‹è¯•å’Œæ€§èƒ½åŸºå‡†
- âœ… **ç¯å¢ƒé€‚é…**ï¼šè‡ªåŠ¨æ£€æµ‹Rediså¯ç”¨æ€§ï¼Œä¼˜é›…é™çº§
- âœ… **æ–‡æ¡£å®Œå–„**ï¼šè¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œæ•…éšœæ’é™¤

ä¸»è¦é—®é¢˜éƒ½æ˜¯ç¯å¢ƒé…ç½®ç›¸å…³ï¼Œä»£ç é€»è¾‘å’Œæµ‹è¯•è®¾è®¡éƒ½æ˜¯æ­£ç¡®çš„ï¼